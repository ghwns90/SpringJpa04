<div id="comments-list">
<!-- 댓글 목록 출력 -->
	{{#commentsList}}
	<div class="card">
		<div class="card-header">
			{{nickname}} &nbsp;&nbsp;&nbsp;&nbsp;
			<button type="button" 
					class="btn btn-sm btn-outline-primary" 
					data-bs-toggle="modal" 
					data-bs-target="#updateModal" 
					data-bs-id="{{id}}"
					data-bs-nickname="{{nickname}}"
					data-bs-body="{{body}}"
					data-bs-article-id="{{article.id}}">수정</button>
			<button type="button" 
					class="btn btn-sm btn-outline-primary" 
					data-bs-toggle="modal" 
					data-bs-target="#deleteModal" 
					data-bs-id="{{id}}"
					data-bs-nickname="{{nickname}}"
					data-bs-body="{{body}}"
					data-bs-article-id="{{article.id}}">삭제</button>		
		</div>
		<div class="card-body">
		  	{{body}}
		</div>
	</div>
	{{/commentsList}}
</div>


<!-- 모달 - 수정 -->
<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="updateModalLabel">댓글 수정</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
          <input type="hidden" id="update-id"/>
          <input type="hidden" id="update-article-id"/>
          <div class="mb-3">
            <label for="nickname" class="col-form-label">Nickname</label>
            <input type="text" class="form-control" id="update-nickname" >
          </div>
          <div class="mb-3">
            <label for="body" class="col-form-label">댓글</label>
            <textarea class="form-control" id="update-body"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="comment-update-btn">수정</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="comment-delete-btn">취소</button>
      </div>
    </div>
  </div>
</div>

<!-- 모달 - 삭제 -->
<!-- Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">삭제 확인</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
      	<span id="id"></span>를 삭제하시겠습니까?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="deleteYes">Yes</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
      </div>
    </div>
  </div>
</div>


<script>
// 모달창을 찾는다
const updateModalEl = document.querySelector('#updateModal');
// 이벤트 연결 : 부트스트랩
// show.bs.modal - modal 창이 화면에 그려지기 전에
// shown.bs.modal - modal 이 열리고 화면에 표시된 후
// hide.bs.modal - modal 이 닫히기 직전
// hidden.bs.modal - modal 이 닫힌 후 완전히 사라진 시점

updateModalEl.addEventListener('show.bs.modal', (e)=>{
	console.log(e);
	// 1. 눌러진 수정 버튼 정보
	const btn = e.relatedTarget;
	
	let id        = btn.dataset.bsId;
	let nickname  = btn.dataset.bsNickname;
	let body      = btn.dataset.bsBody;
	let articleId = btn.dataset.bsArticleId; // data-bs-article-id
	
	// 3. modal 창에 출력
	document.querySelector('#update-article-id').value = articleId;
	document.querySelector('#update-id').value         = id;
	document.querySelector('#update-nickname').value   = nickname;
	document.querySelector('#update-body').value       = body;
})

</script>
<script>

	// modal 창의 수정버튼 클릭 - comment-update-btn
	const commentUpdateBtnEl = document.querySelector('#comment-update-btn');
	commentUpdateBtnEl.addEventListener('click', ()=>{
		let comment = {
				id        : document.querySelector('#update-id').value,
				nickname  : document.querySelector('#update-nickname').value,
				articleId : document.querySelector('#update-article-id').value,
				body      : document.querySelector('#update-body').value
		}
		
		let url    = '/api/comments/' + comment.id
		let params = {
				method : 'PATCH',
				headers : {'Content-Type' : 'application/json;charset=utf-8'},
				body   : JSON.stringify( comment )
		}
		
		fetch(url, params)
			.then((response) => {
				console.log(response);
				let msg = (response.ok)
							? "댓그리 수정되었습니다" : "댓글 수정 실패" 
				alert(msg)
				window.location.reload();
			})
	})
	
	// modal 창의 삭제버튼 클릭 - comment-delete-btn
	const deleteModalEl = document.querySelector('#deleteModal');
	deleteModal.addEventListener('show.bs.modal', (e) => {
		console.log(e);
		// 클릭한 삭제버튼을 찾는다	
		const btn = e.relatedTarget;
		// 삭제버튼의 data-bs-* 를 가져온다
		let id        = btn.dataset.bsId;
		let nickname  = btn.dataset.bsNickname;
		let body      = btn.dataset.bsBody;
		let articleId = btn.dataset.bsArticleId;
		// <span id="id"></span> 에 넣어준다
		const spanIdEl = deleteModalEl.querySelector('#id');
		spanIdEl.innerHTML  = id;
		spanIdEl.dataset.id = id;
		
		let comment = {
				
		}
	});

<!-- 댓글 삭제 버튼 -->
	const deleteYesEl = document.getElementById('deleteYes');
	
	deleteYesEl.addEventListener('click', ()=>{
		
		let url     = '/api/article';
		let params  = {
				
			method  : 'DELETE',
			headers : {'Content-Type' : 'application/json;charset=utf-8'},
			body    : JSON.stringify({
						id : document.querySelector('#id').dataset.id
					  })							  
				  
		}
		//console.log(url);
		fetch(url, params)
		.then((response) => {
			console.log(response);
			let msg = (response.ok)
						? "댓그리 삭제되었습니다" : "댓글 삭제 실패" 
			alert(msg)
			window.location.reload();
		})	
		
	
	});












</script>